(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.videojsDash=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){(function(global){"use strict";exports.__esModule=true;exports["default"]=setupAudioTracks;var _dashjs=typeof window!=="undefined"?window["dashjs"]:typeof global!=="undefined"?global["dashjs"]:null;var _dashjs2=_interopRequireDefault(_dashjs);var _video=typeof window!=="undefined"?window["videojs"]:typeof global!=="undefined"?global["videojs"]:null;var _video2=_interopRequireDefault(_video);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function handlePlaybackMetadataLoaded(player,tech){var mediaPlayer=player.dash.mediaPlayer;var dashAudioTracks=mediaPlayer.getTracksFor("audio");var videojsAudioTracks=player.audioTracks();function generateIdFromTrackIndex(index){return"dash-audio-"+index}function findDashAudioTrack(dashAudioTracks,videojsAudioTrack){return dashAudioTracks.find(function(_ref){var index=_ref.index;return generateIdFromTrackIndex(index)===videojsAudioTrack.id})}if(videojsAudioTracks.length){tech.clearTracks(["audio"])}var currentAudioTrack=mediaPlayer.getCurrentTrackFor("audio");dashAudioTracks.forEach(function(dashTrack){var label=dashTrack.lang;if(dashTrack.roles&&dashTrack.roles.length){label+=" ("+dashTrack.roles.join(", ")+")"}videojsAudioTracks.addTrack(new _video2["default"].AudioTrack({enabled:dashTrack===currentAudioTrack,id:generateIdFromTrackIndex(dashTrack.index),kind:dashTrack.kind||"main",label:label,language:dashTrack.lang}))});videojsAudioTracks.addEventListener("change",function(){for(var i=0;i<videojsAudioTracks.length;i++){var track=videojsAudioTracks[i];if(track.enabled){var dashAudioTrack=findDashAudioTrack(dashAudioTracks,track);mediaPlayer.setCurrentTrack(dashAudioTrack);continue}}})}function setupAudioTracks(player,tech){player.dash.mediaPlayer.on(_dashjs2["default"].MediaPlayer.events.PLAYBACK_METADATA_LOADED,handlePlaybackMetadataLoaded.bind(null,player,tech))}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],2:[function(require,module,exports){(function(global){"use strict";exports.__esModule=true;exports["default"]=setupTextTracks;var _dashjs=typeof window!=="undefined"?window["dashjs"]:typeof global!=="undefined"?global["dashjs"]:null;var _dashjs2=_interopRequireDefault(_dashjs);var _video=typeof window!=="undefined"?window["videojs"]:typeof global!=="undefined"?global["videojs"]:null;var _video2=_interopRequireDefault(_video);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function find(l,f){for(var i=0;i<l.length;i++){if(f(l[i])){return l[i]}}}function attachDashTextTracksToVideojs(player,tech,tracks){var trackDictionary=[];var tracksAttached=tracks.map(function(track){return{dashTrack:track,trackConfig:{label:track.lang,language:track.lang,srclang:track.lang}}}).map(function(_ref){var trackConfig=_ref.trackConfig,dashTrack=_ref.dashTrack;var remoteTextTrack=player.addRemoteTextTrack(trackConfig,true);trackDictionary.push({textTrack:remoteTextTrack.track,dashTrack:dashTrack});return remoteTextTrack});function updateActiveDashTextTrack(){var dashMediaPlayer=player.dash.mediaPlayer;var textTracks=player.textTracks();var activeTextTrackIndex=-1;var _loop=function _loop(i){var textTrack=textTracks[i];if(textTrack.mode==="showing"){var dictionaryLookupResult=find(trackDictionary,function(track){return track.textTrack===textTrack});var dashTrackToActivate=dictionaryLookupResult?dictionaryLookupResult.dashTrack:null;if(dashTrackToActivate){activeTextTrackIndex=tracks.indexOf(dashTrackToActivate)}}};for(var i=0;i<textTracks.length;i+=1){_loop(i)}if(activeTextTrackIndex!==dashMediaPlayer.getCurrentTextTrackIndex()){dashMediaPlayer.setTextTrack(activeTextTrackIndex)}}player.textTracks().on("change",updateActiveDashTextTrack);player.one("loadstart",function(){player.textTracks().off("change",updateActiveDashTextTrack)});updateActiveDashTextTrack();return tracksAttached}function setupTextTracks(player,tech,options){if(window.VTTCue&&!/\[native code\]/.test(window.VTTCue.toString())){window.VTTCue=false}var dashTracksAttachedToVideoJs=[];if(tech.featuresNativeTextTracks){_video2["default"].log.error("You must pass {html: {nativeCaptions: false}} in the videojs constructor "+"to use text tracks in videojs-contrib-dash");return}var mediaPlayer=player.dash.mediaPlayer;function clearDashTracks(){dashTracksAttachedToVideoJs.forEach(player.removeRemoteTextTrack.bind(player));dashTracksAttachedToVideoJs=[]}function handleTextTracksAdded(_ref2){var index=_ref2.index,tracks=_ref2.tracks;mediaPlayer.off(_dashjs2["default"].MediaPlayer.events.TEXT_TRACKS_ADDED,handleTextTracksAdded);clearDashTracks();if(!tracks.length){return}dashTracksAttachedToVideoJs=attachDashTextTracksToVideojs(player,tech,tracks,options)}mediaPlayer.on(_dashjs2["default"].MediaPlayer.events.TEXT_TRACKS_ADDED,handleTextTracksAdded);function cleanup(){mediaPlayer.off(_dashjs2["default"].MediaPlayer.events.TEXT_TRACKS_ADDED,handleTextTracksAdded);player.one("loadstart",clearDashTracks)}mediaPlayer.on(_dashjs2["default"].MediaPlayer.events.CAN_PLAY,cleanup)}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],3:[function(require,module,exports){(function(global){var win;if(typeof window!=="undefined"){win=window}else if(typeof global!=="undefined"){win=global}else if(typeof self!=="undefined"){win=self}else{win={}}module.exports=win}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],4:[function(require,module,exports){(function(global){"use strict";exports.__esModule=true;var _window=require("global/window");var _window2=_interopRequireDefault(_window);var _video=typeof window!=="undefined"?window["videojs"]:typeof global!=="undefined"?global["videojs"]:null;var _video2=_interopRequireDefault(_video);var _dashjs=typeof window!=="undefined"?window["dashjs"]:typeof global!=="undefined"?global["dashjs"]:null;var _dashjs2=_interopRequireDefault(_dashjs);var _setupAudioTracks=require("./setup-audio-tracks");var _setupAudioTracks2=_interopRequireDefault(_setupAudioTracks);var _setupTextTracks=require("./setup-text-tracks");var _setupTextTracks2=_interopRequireDefault(_setupTextTracks);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Html5DashJS=function(){function Html5DashJS(source,tech,options){var _this=this;_classCallCheck(this,Html5DashJS);options=options||tech.options_;this.player=(0,_video2["default"])(options.playerId);this.player.dash=this.player.dash||{};this.tech_=tech;this.el_=tech.el();this.elParent_=this.el_.parentNode;if(!source.src){return}tech.isReady_=false;if(Html5DashJS.updateSourceData){_video2["default"].log.warn("updateSourceData has been deprecated."+' Please switch to using hook("updatesource", callback).');source=Html5DashJS.updateSourceData(source)}Html5DashJS.hooks("updatesource").forEach(function(hook){source=hook(source)});var manifestSource=source.src;this.keySystemOptions_=Html5DashJS.buildDashJSProtData(source.keySystemOptions);this.player.dash.mediaPlayer=_dashjs2["default"].MediaPlayer().create();this.mediaPlayer_=this.player.dash.mediaPlayer;if(Html5DashJS.useVideoJSDebug){_video2["default"].log.warn("useVideoJSDebug has been deprecated."+' Please switch to using hook("beforeinitialize", callback).');Html5DashJS.useVideoJSDebug(this.mediaPlayer_)}if(Html5DashJS.beforeInitialize){_video2["default"].log.warn("beforeInitialize has been deprecated."+' Please switch to using hook("beforeinitialize", callback).');Html5DashJS.beforeInitialize(this.player,this.mediaPlayer_)}Html5DashJS.hooks("beforeinitialize").forEach(function(hook){hook(_this.player,_this.mediaPlayer_)});this.mediaPlayer_.initialize();if(options.dash){Object.keys(options.dash).forEach(function(key){var _mediaPlayer_;var dashOptionsKey="set"+key.charAt(0).toUpperCase()+key.slice(1);var value=options.dash[key];if(_this.mediaPlayer_.hasOwnProperty(dashOptionsKey)){_video2["default"].log.warn("Using dash options in videojs-contrib-dash without the set prefix "+("has been deprecated. Change '"+key+"' to '"+dashOptionsKey+"'"));key=dashOptionsKey}if(!_this.mediaPlayer_.hasOwnProperty(key)){_video2["default"].log.warn("Warning: dash configuration option unrecognized: "+key);return}if(!Array.isArray(value)){value=[value]}(_mediaPlayer_=_this.mediaPlayer_)[key].apply(_mediaPlayer_,value)})}this.mediaPlayer_.attachView(this.el_);this.mediaPlayer_.setAutoPlay(false);_setupAudioTracks2["default"].call(null,this.player,tech);_setupTextTracks2["default"].call(null,this.player,tech,options);this.mediaPlayer_.setProtectionData(this.keySystemOptions_);this.mediaPlayer_.attachSource(manifestSource);this.tech_.triggerReady()}Html5DashJS.buildDashJSProtData=function buildDashJSProtData(keySystemOptions){var output={};if(!keySystemOptions||!Array.isArray(keySystemOptions)){return null}for(var i=0;i<keySystemOptions.length;i++){var keySystem=keySystemOptions[i];var options=_video2["default"].mergeOptions({},keySystem.options);if(options.licenseUrl){options.serverURL=options.licenseUrl;delete options.licenseUrl}output[keySystem.name]=options}return output};Html5DashJS.prototype.dispose=function dispose(){if(this.mediaPlayer_){this.mediaPlayer_.reset()}if(this.player.dash){delete this.player.dash}};Html5DashJS.prototype.duration=function duration(){var duration=this.el_.duration;if(duration===Number.MAX_VALUE){return Infinity}return duration};Html5DashJS.hooks=function hooks(type,hook){Html5DashJS.hooks_[type]=Html5DashJS.hooks_[type]||[];if(hook){Html5DashJS.hooks_[type]=Html5DashJS.hooks_[type].concat(hook)}return Html5DashJS.hooks_[type]};Html5DashJS.hook=function hook(type,_hook){Html5DashJS.hooks(type,_hook)};Html5DashJS.removeHook=function removeHook(type,hook){var index=Html5DashJS.hooks(type).indexOf(hook);if(index===-1){return false}Html5DashJS.hooks_[type]=Html5DashJS.hooks_[type].slice();Html5DashJS.hooks_[type].splice(index,1);return true};return Html5DashJS}();Html5DashJS.hooks_={};var canHandleKeySystems=function canHandleKeySystems(source){source=JSON.parse(JSON.stringify(source));if(Html5DashJS.updateSourceData){_video2["default"].log.warn("updateSourceData has been deprecated."+' Please switch to using hook("updatesource", callback).');source=Html5DashJS.updateSourceData(source)}Html5DashJS.hooks("updatesource").forEach(function(hook){source=hook(source)});var videoEl=document.createElement("video");if(source.keySystemOptions&&!(navigator.requestMediaKeySystemAccess||videoEl.msSetMediaKeys)){return false}return true};_video2["default"].DashSourceHandler=function(){return{canHandleSource:function canHandleSource(source){var dashExtRE=/\.mpd/i;if(!canHandleKeySystems(source)){return""}if(_video2["default"].DashSourceHandler.canPlayType(source.type)){return"probably"}else if(dashExtRE.test(source.src)){return"maybe"}else{return""}},handleSource:function handleSource(source,tech,options){return new Html5DashJS(source,tech,options)},canPlayType:function canPlayType(type){return _video2["default"].DashSourceHandler.canPlayType(type)}}};_video2["default"].DashSourceHandler.canPlayType=function(type){var dashTypeRE=/^application\/dash\+xml/i;if(dashTypeRE.test(type)){return"probably"}return""};if(!!_window2["default"].MediaSource){_video2["default"].getTech("Html5").registerSourceHandler(_video2["default"].DashSourceHandler(),0)}_video2["default"].Html5DashJS=Html5DashJS;exports["default"]=Html5DashJS}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./setup-audio-tracks":1,"./setup-text-tracks":2,"global/window":3}]},{},[4])(4)});